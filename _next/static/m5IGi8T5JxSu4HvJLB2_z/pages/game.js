(window.webpackJsonp=window.webpackJsonp||[]).push([[9],{212:function(t,e,n){__NEXT_REGISTER_PAGE("/game",function(){return t.exports=n(235),{page:t.exports.default}})},235:function(t,e,n){"use strict";n.r(e);n(19);var i=n(0),a=n.n(i);function o(t,e,n){this.context=t,this.urlList=e,this.onload=n,this.bufferList=new Array,this.loadCount=0}o.prototype.loadBuffer=function(t,e){var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="arraybuffer";var i=this;n.onload=function(){i.context.decodeAudioData(n.response,function(n){n?(i.bufferList[e]=n,++i.loadCount==i.urlList.length&&i.onload(i.bufferList)):alert("error decoding file data: "+t)},function(t){console.error("decodeAudioData error",t)})},n.onerror=function(){alert("BufferLoader: XHR error")},n.send()},o.prototype.load=function(){for(var t=0;t<this.urlList.length;++t)this.loadBuffer(this.urlList[t],t)};var r=o;function s(t,e,n){return function(i){var a=t.createMediaStreamSource(i),o=t.createAnalyser();o.fftSize=2048,a.connect(o),a=t.createMediaStreamSource(i);var r=function(t,e,n,i,a){var o=t.createScriptProcessor(512);return o.onaudioprocess=function(t){return function(e){for(var n,i=e.inputBuffer.getChannelData(0),a=i.length,o=0,r=0;r<a;r++)n=i[r],Math.abs(n)>=this.clipLevel&&(this.clipping=!0,this.lastClip=window.performance.now()),o+=n*n;var s=Math.sqrt(o/a);this.volume>.6&&t(this.volume),this.volume=Math.max(s,this.volume*this.averaging)}}(e),o.clipping=!1,o.lastClip=0,o.volume=0,o.clipLevel=n||.5,o.averaging=i||.95,o.clipLag=a||750,o.connect(t.destination),o.checkClipping=function(){return!!this.clipping&&(this.lastClip+this.clipLag<window.performance.now()&&(this.clipping=!1),this.clipping)},o.shutdown=function(){this.disconnect(),this.onaudioprocess=null},o}(t,n);a.connect(r),e(t,o)}}var l=4,u=.9;function c(t){return(c="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function h(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}function g(t){return(g=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function f(t,e){return(f=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function p(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}n.d(e,"default",function(){return L});var d=100,y=60/d,m=[],v=new Float32Array(1024);function b(t,e){this.state.streamAcquired||this.setState({streamAcquired:!0}),e.getFloatTimeDomainData(v);!function(t,e){for(var n=t.length,i=Math.floor(n/2),a=-1,o=0,r=0,s=!1,c=new Array(i),h=0;h<n;h++){var g=t[h];r+=g*g}if((r=Math.sqrt(r/n))<.01)return-1;for(var f=1,p=l;p<i;p++){var d=0;for(h=0;h<i;h++)d+=Math.abs(t[h]-t[h+p]);if(d=1-d/i,c[p]=d,d>u&&d>f)s=!0,d>o&&(o=d,a=p);else if(s)return e/(a+(c[a+1]-c[a-1])/c[a]*8);f=d}}(v,44100);window.requestAnimationFrame(b.bind(this,t,e))}var L=function(t){function e(){var t,n,i,a,o,r,s;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e);for(var l=arguments.length,u=new Array(l),h=0;h<l;h++)u[h]=arguments[h];return i=this,n=!(a=(t=g(e)).call.apply(t,[this].concat(u)))||"object"!==c(a)&&"function"!=typeof a?p(i):a,o=p(p(n)),s={leftHand:"up",rightHand:"up",streamAcquired:!1,ready:!1,judging:!1,level:1,result:"",playing:!1},(r="state")in o?Object.defineProperty(o,r,{value:s,enumerable:!0,configurable:!0,writable:!0}):o[r]=s,n}var n,i,o;return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&f(t,e)}(e,a.a.Component),n=e,(i=[{key:"componentDidMount",value:function(){var t,e,n,i,a=this,o=new AudioContext;this.audioCtx=o,function(t,e){try{navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia,navigator.getUserMedia(t,e,function(){alert("Stream generation failed.")})}catch(t){alert("getUserMedia threw exception :"+t)}}({audio:{mandatory:{googEchoCancellation:"false",googAutoGainControl:"false",googNoiseSuppression:"false",googHighpassFilter:"false"},optional:[]}},s(this.audioCtx,b.bind(this),(t=function(t){this.setState({lastPitch:this.state.currentPitch}),m.push(this.audioCtx.currentTime)}.bind(this),e=40,n=!0,function(){var a=this,o=arguments,r=n&&!i;clearTimeout(i),i=setTimeout(function(){i=null,n||t.apply(a,o)},e),r&&t.apply(a,o)}))),this.bufferLoader=new r(this.audioCtx,["/static/sounds/bongo0.mp3","/static/sounds/bongo1.mp3"],function(){a.bongo0=a.bufferLoader.bufferList[0],a.bongo1=a.bufferLoader.bufferList[1],a.setState({ready:!0})}),this.bufferLoader.load(),document.addEventListener("keydown",this.handleKeyDown.bind(this))}},{key:"handleKeyDown",value:function(){m.push(this.audioCtx.currentTime)}},{key:"playSound",value:function(t,e){var n=this.audioCtx.createBufferSource();n.buffer=t,n.connect(this.audioCtx.destination),n.start(e)}},{key:"playLeftBongo",value:function(t){var e=this,n=this.audioCtx.createBufferSource();n.buffer=this.bongo0,n.connect(this.audioCtx.destination),n.start(t);t-=this.audioCtx.currentTime;setTimeout(function(){e.setState({leftHand:"down"})},900*t),setTimeout(function(){e.setState({leftHand:"up"})},1200*t)}},{key:"playRightBongo",value:function(t){var e=this,n=this.audioCtx.createBufferSource();n.buffer=this.bongo1,n.connect(this.audioCtx.destination),n.start(t);t-=this.audioCtx.currentTime;setTimeout(function(){e.setState({rightHand:"down"})},900*t),setTimeout(function(){e.setState({rightHand:"up"})},1200*t)}},{key:"startJudging",value:function(t){var e=this;console.log("judging"),setTimeout(function(){e.setState({judging:!0})},400),m=[],setTimeout(function(){e.finishJudging(t)},3e3)}},{key:"finishJudging",value:function(t){var e,n=m[0];e=m.map(function(t){return t-n}),console.log("song:",t),console.log("yourtime:",e);var i=t.map(function(t,n){return isNaN(e[n])?0:1-Math.abs(t-e[n])});console.log("difference:",i);var a,o=i.reduce(function(t,e){return t+e},0);a=Math.round(o/t.length*100),this.setState({score:a,result:this.scoreInterpretation(a),judging:!1,playing:!1})}},{key:"playSong1",value:function(){var t=this,e=this.audioCtx.currentTime+.1;this.playLeftBongo(e),this.playLeftBongo(e+.5*y),this.playRightBongo(e+y),this.playRightBongo(e+1.5*y),this.playLeftBongo(e+2*y),this.playLeftBongo(e+2.5*y),this.playRightBongo(e+3*y);var n=[0,.5*y,1*y,1.5*y,2*y,2.5*y,3*y];setTimeout(function(){t.startJudging(n)},1800)}},{key:"playSong2",value:function(){var t=this,e=this.audioCtx.currentTime+.1;this.playLeftBongo(e),this.playLeftBongo(e+.5*y),this.playLeftBongo(e+.75*y),this.playRightBongo(e+y),this.playRightBongo(e+1.5*y),this.playLeftBongo(e+2*y),this.playLeftBongo(e+2.5*y),this.playLeftBongo(e+2.75*y),this.playRightBongo(e+3*y);var n=[0,.5*y,.75*y,1*y,1.5*y,2*y,2.75*y,3*y];setTimeout(function(){t.startJudging(n)},1800)}},{key:"playSong3",value:function(){var t=this,e=this.audioCtx.currentTime+.1;this.playLeftBongo(e),this.playLeftBongo(e+2*y),this.playLeftBongo(e+2.12*y),this.playLeftBongo(e+2.25*y),this.playLeftBongo(e+2.37*y),this.playLeftBongo(e+2.5*y),this.playLeftBongo(e+2.67*y),this.playLeftBongo(e+2.75*y),this.playRightBongo(e+3*y),this.playRightBongo(e+3.25*y),this.playRightBongo(e+3.5*y),this.playRightBongo(e+3.75*y);var n=[0,.5*y,.75*y,1*y,1.5*y,2*y,2.75*y,3*y];setTimeout(function(){t.startJudging(n)},1800)}},{key:"play",value:function(){this.setState({playing:!0,result:"",angry:!1}),[this.playSong1.bind(this),this.playSong1.bind(this),this.playSong2.bind(this),this.playSong3.bind(this)][this.state.level-1]()}},{key:"scoreInterpretation",value:function(t){return t>90?(this.setState({levelCleared:!0}),"REALLY GOOD!"):t>80?(this.setState({levelCleared:!0}),"NICE, BUT COULD BE BETTER"):t>50?(this.setState({angry:!0}),"PRETTY BAD! TRY AGAIN!"):(this.setState({angry:!0}),"THAT SOUNDED NOTHING LIKE WHAT I DID! TRY AGAIN!")}},{key:"nextLevel",value:function(){y=60/(d+=10),this.setState({score:0,level:this.state.level+1,result:"",playing:!1,levelCleared:!1})}},{key:"render",value:function(){return a.a.createElement("div",null,a.a.createElement("style",null,"\n        button{\n          height: 100px;\n          width: 500px;\n          background-color:orange;\n          font-size: 60px;\n          font-weight: bold;\n          border: 0px;\n          color: #0c186c;\n          border-radius: 10px\n        }\n\n        .cat {\n          position: relative;\n          height: 400px;\n          width: 400px;\n          margin: auto;\n        }\n        .cat img{\n          position: absolute;\n          top: 0px;\n          left: 0px;\n        }\n\n        .cat img.up {\n          opacity: 0\n        }\n\n        .cat img.neutral.up {\n          opacity: 1\n        }\n\n        .cat img.neutral.down {\n          opacity: 0\n        }\n\n        .results {\n          height: 200px\n        }\n\n        .result {\n          height: 50px;\n          margin-bottom: 20px;\n          padding-bottom: 80px;\n        }\n\n        .preload {\n          opacity: 0\n        }\n\n      "),a.a.createElement("div",{className:"result"},"Â ",this.state.result),a.a.createElement("div",{className:"cat"},this.state.angry?a.a.createElement("img",{src:"/static/images/angry.svg"}):this.state.judging?a.a.createElement("img",{src:"/static/images/listening.svg"}):this.state.levelCleared?a.a.createElement("img",{src:"/static/images/success.svg"}):a.a.createElement("div",null,a.a.createElement("img",{className:this.state.leftHand,src:"/static/images/left paw.svg"}),a.a.createElement("img",{className:this.state.rightHand,src:"/static/images/right-paw.svg"}),a.a.createElement("img",{className:"neutral "+this.state.leftHand+" "+this.state.rightHand,src:"/static/images/neutral.svg"}))),a.a.createElement("div",{className:"results"},a.a.createElement("div",{className:"judging"},this.state.judging?"I AM JUDGING NOW":""),a.a.createElement("div",{className:"level"},"Level: ",this.state.level),this.state.score>80?a.a.createElement("button",{onClick:this.nextLevel.bind(this)},"NEXT LEVEL"):"",this.state.streamAcquired&&this.state.ready?this.state.playing?"":this.state.levelCleared?"":a.a.createElement("button",{onClick:this.play.bind(this)},"START"):"Waiting for assets and microphone permissions."),a.a.createElement("img",{className:"preload",src:"/static/images/angry.svg"}),a.a.createElement("img",{className:"preload",src:"/static/images/listening.svg"}),a.a.createElement("img",{className:"preload",src:"/static/images/success.svg"}))}}])&&h(n.prototype,i),o&&h(n,o),e}()}},[[212,1,0]]]);